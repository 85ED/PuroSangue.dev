<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrida de Rua</title>
</head>

<body>
    <h2>FIVE TURTLES - Maratona</h2>
    Nomes dos participantes: <input id="ipt_corredor">
    <button onclick="participante()">Incluir Corredor</button><br><br>
    Distância da prova: <input id="ipt_distancia">
    <button onclick="km()">Gravar Distância</button><br><br>
    <button onclick="largada()">Dar a Largada</button><br><br>
    <div id="part"></div>
    <div id="tempo"></div>
</body>

</html>

<script>

    var vt_participantes = [];
    var vt_distancias = [];
    var vt_tempos = [];
    var vt_voltas = [];

    function participante() {

        var corredor = ipt_corredor.value;

        if (corredor != ``) {
            vt_participantes.push(corredor);
            ipt_corredor.value = ``;
            setTimeout(() => { part.innerHTML = `Corredor cadastrado com sucesso!`; }, 1000);
            setTimeout(() => { part.innerHTML = ``; }, 3000);
        } else {
            alert(`Favor informar um participante!`);
        }

    }

    function km() {

        var kms = Number(ipt_distancia.value);

        if (kms != `` && (kms >= 5 && kms <= 42)) {
            vt_distancias.push(kms);
            ipt_distancia.value = ``;
            setTimeout(() => { part.innerHTML = `Distância cadastrada com sucesso!`; }, 1000);
            setTimeout(() => { part.innerHTML = ``; }, 3000);
        } else {
            alert(`Favor informar um valor válido entre 5 e 42km!`);
        }

    }

    function largada() {

        if (vt_participantes.length < 5) {
            alert(`Cadastre no mínimo 5 participantes para a prova.`);
            return;
        }

        var distancia = vt_distancias[vt_distancias.length - 1];
        vt_tempos = [];
        vt_voltas = [];

        for (var index = 0; index < vt_participantes.length; index++) {
            vt_tempos.push(0);
            vt_voltas.push([]);
        }

        var melhor_volta = 10;
        var pior_volta = 0;
        var nome_melhor = ``;
        var nome_pior = ``;
        var km_melhor = 0;
        var km_pior = 0;

        for (var km = 1; km <= distancia; km++) {

            var menor_tempo_km = 1000; // parametro fixo so pra saber quem tem o menor 
            var nome_menor = ``;

            for (var index = 0; index < vt_participantes.length; index++) {

                var tempokm = +(Math.random() * (6 - 4) + 4).toFixed(1);
                vt_tempos[index] += tempokm;
                vt_voltas[index].push(tempokm);

                if (tempokm < melhor_volta) {
                    melhor_volta = tempokm;
                    nome_melhor = vt_participantes[index];
                    km_melhor = km;
                }

                if (tempokm > pior_volta) {
                    pior_volta = tempokm;
                    nome_pior = vt_participantes[index];
                    km_pior = km;
                }

                if (vt_tempos[index] < menor_tempo_km) {
                    menor_tempo_km = vt_tempos[index];
                    nome_menor = vt_participantes[index];
                }

            }

            if (km != distancia) {
                alert(`Na volta ${km}, o líder é ${nome_menor} com ${menor_tempo_km.toFixed(1)} min.`);
            }
        }

        // classificacao
        var primeiro = 0;
        var segundo = 0;
        var terceiro = 0;

        for (var index = 1; index < vt_tempos.length; index++) {
            if (vt_tempos[index] < vt_tempos[primeiro]) {
                terceiro = segundo;
                segundo = primeiro;
                primeiro = index;
            } else if (vt_tempos[index] < vt_tempos[segundo] || primeiro == segundo) {
                terceiro = segundo;
                segundo = index;
            } else if (vt_tempos[index] < vt_tempos[terceiro] || segundo == terceiro) {
                terceiro = index;
            }
        }

        var podium = `
        1º lugar: ${vt_participantes[primeiro]} - ${vt_tempos[primeiro].toFixed(1)} min.<br>
        2º lugar: ${vt_participantes[segundo]} - ${vt_tempos[segundo].toFixed(1)} min.<br>
        3º lugar: ${vt_participantes[terceiro]} - ${vt_tempos[terceiro].toFixed(1)} min.<br><br>`;

        var detalhado = ``;

        for (var index = 0; index < vt_participantes.length; index++) {
            detalhado += `${vt_participantes[index]}:<br>`;
            var acumulado = 0;
            for (var volta = distancia - 1; volta >= 0; volta--) {
                var tempo_volta = vt_voltas[index][volta];
                acumulado += tempo_volta;
                detalhado += `km ${volta + 1}: ${tempo_volta.toFixed(1)} min - acumulado: ${acumulado.toFixed(1)} min<br>`;
            }
            detalhado += `<br>`;
        }

        var estatisticas = `
        Melhor volta: ${nome_melhor} - ${melhor_volta.toFixed(1)} min - km ${km_melhor}<br>
        Pior volta: ${nome_pior} - ${pior_volta.toFixed(1)} min - km ${km_pior}<br>`;

        tempo.innerHTML = podium + detalhado + estatisticas;

    }

</script>
