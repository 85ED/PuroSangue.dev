<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>PuroSangue.dev</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="content">
        <div class="title" id="title">
            <img src="img/logo.png" id="imgLogo" alt="">

            <div id="loader" style="display:none; text-align:center;">
                <img src="img/cavalodoido.gif" alt="Carregando..." width="100">
                <p>Preparando os cavalos...</p>
            </div>

            <button onclick="iniciar()" id="btnIniciar">Iniciar Jogo</button>
        </div>

        <div class="cavaloContent" id="cavaloContent">
            <p><b>Cadastro de Cavalos</b></p>
            Informe a quantidade de cavalos: <input type="text" id="ipt_qtd"><br>
            Informe um cavalo: <input id="ipt_cavalo"><br>
            <button onclick="cadastrarCavalo()">Cadastrar Cavalo</button><br><br>
        </div>

        <div class="voltasContent" id="voltasContent">
            Informe a quantidade de voltas: <input type="text" id="ipt_voltas">
            <p><b>Iniciar Voltas do Torneio</b></p>
            <button onclick="volta()">Dar uma volta</button>
        </div>

        <div id="txt_cavalo"></div>
    </div>

    <audio autoplay>
        <source src="" type="">
    </audio>

    <script>
        var vt_cavalos = [];
        var vt_somatotal = [];

        function cadastrarCavalo() {
            var nomecavalo = ipt_cavalo.value;
            var quantidadeCavalo = Number(ipt_qtd.value);

            if (nomecavalo === "") {
                alert("Informe o nome do cavalo!");
                return;
            }

            if (vt_cavalos.length >= quantidadeCavalo) {
                alert(`Você já cadastrou todos os ${quantidadeCavalo} cavalos.`);
                return;
            }

            document.getElementById("txt_cavalo").style.display = "flex";

            vt_cavalos.push(nomecavalo);
            vt_somatotal.push(0);
            ipt_cavalo.value = "";
            txt_cavalo.innerHTML += `<span> <b style="color: var(--red)">${nomecavalo}</b>, cadastrado no torneio! </span><br>`;

            if (vt_cavalos.length === quantidadeCavalo) {
                document.getElementById("voltasContent").style.display = "flex";
                document.getElementById("voltasContent").style.marginTop = "5rem";
                document.getElementById("cavaloContent").style.display = 'none';
                document.getElementById("title").style.display = 'none';
                document.getElementById("txt_cavalo").style.display = 'none';
            }
        }

        function volta() {
            var voltasTotal = Number(ipt_voltas.value);

            if (vt_cavalos.length < 2 || vt_cavalos.length > 6) {
                alert("Cadastre entre 2 e 6 cavalos.");
                return;
            }

            if (voltasTotal < 5 || voltasTotal > 10) {
                alert("Voltas devem estar entre 5 e 10.");
                return;
            }

            txt_cavalo.innerHTML = "";
            document.getElementById("txt_cavalo").style.display = "block";
            document.getElementById("loader").style.display = "flex";
            document.getElementById("loader").style.marginTop = "5rem";

            for (let volta = 1; volta <= voltasTotal; volta++) {
                (function (voltaAtual, rodada) {
                    setTimeout(function () {
                        txt_cavalo.innerHTML += `<b>Volta ${voltaAtual}</b><br>`;

                        for (let i = 0; i < vt_cavalos.length; i++) {
                            let tempo = Number((Math.random() * 2 + 7).toFixed(1));
                            vt_somatotal[i] += tempo;
                            txt_cavalo.innerHTML += `Cavalo ${vt_cavalos[i]} fez ${tempo}s - Acumulado: ${vt_somatotal[i].toFixed(1)}s<br>`;
                        }

                        let indicesOrdenados = vt_somatotal.map((v, i) => i)
                            .sort((a, b) => vt_somatotal[a] - vt_somatotal[b]);

                        txt_cavalo.innerHTML += `<u>Classificação Parcial:</u><br>`;
                        txt_cavalo.innerHTML += `1º - ${vt_cavalos[indicesOrdenados[0]]}<br>`;
                        txt_cavalo.innerHTML += `2º - ${vt_cavalos[indicesOrdenados[1]]}<br>`;
                        txt_cavalo.innerHTML += `3º - ${vt_cavalos[indicesOrdenados[2]]}<br><hr>`;

                        if (rodada === voltasTotal - 1) {
                            setTimeout(() => {
                                txt_cavalo.innerHTML += `<h3>Pódio PuroSangue.Dev</h3>`;
                                txt_cavalo.innerHTML += `${vt_cavalos[indicesOrdenados[0]]} - ${vt_somatotal[indicesOrdenados[0]].toFixed(1)}s<br>`;
                                txt_cavalo.innerHTML += `${vt_cavalos[indicesOrdenados[1]]} - ${vt_somatotal[indicesOrdenados[1]].toFixed(1)}s<br>`;
                                txt_cavalo.innerHTML += `${vt_cavalos[indicesOrdenados[2]]} - ${vt_somatotal[indicesOrdenados[2]].toFixed(1)}s<br><br>`;

                                txt_cavalo.innerHTML += `<h4>Tempos Finais (do último pro primeiro):</h4>`;
                                for (let i = indicesOrdenados.length - 1; i >= 0; i--) {
                                    txt_cavalo.innerHTML += `${vt_cavalos[indicesOrdenados[i]]} - ${vt_somatotal[indicesOrdenados[i]].toFixed(1)}s<br>`;
                                }

                                document.getElementById("loader").style.display = "none";

                            }, 3000); // Espera 3s após a última volta
                        }

                    }, 3000 * rodada);
                })(volta, volta - 1);
            }
        }

        function iniciar() {
            document.getElementById("btnIniciar").style.display = 'none';
            var cavaloConteudo = document.getElementById("cavaloContent");
            cavaloConteudo.style.display = 'flex';
            cavaloConteudo.style.marginTop = '-5rem';
        }
    </script>

</body>
</html>
